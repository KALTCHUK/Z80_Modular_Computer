0001   0000             ;==================================================================================
0002   0000             ; LINER.ASM - CONSOLE MANAGER TEST FOR MONITOR 2.0 - USE WITH VT100 TEMINAL
0003   0000             ; (Should behave like CCP on CP/M)
0004   0000             ;
0005   0000             ; Backspace = delete last character
0006   0000             ;   ^U = ^X = delete all the line
0007   0000             ;
0008   0000             ; After user types <ENTER>, the line is saved in line_buffer and control returns
0009   0000             ; to Monitor program.
0010   0000             ;==================================================================================
0011   0000             TPA			.EQU	0100H		; Transient Programs Area
0012   0000             MONITOR		.EQU	0D000H		; Monitor entry point
0013   0000             BIOS		.EQU	0E600H		; BIOS entry point
0014   0000             DMA			.EQU	0080H		; Buffer user by liner
0015   0000             
0016   0000             ;================================================================================================
0017   0000             ; BIOS functions.
0018   0000             ;================================================================================================
0019   0000             BOOT:		.EQU	BIOS				;  0 Initialize.
0020   0000             WBOOT:		.EQU	BIOS+(3*1)			;  1 Warm boot.
0021   0000             CONST:		.EQU	BIOS+(3*2)			;  2 Console status.
0022   0000             CONIN:		.EQU	BIOS+(3*3)			;  3 Console input.
0023   0000             CONOUT:		.EQU	BIOS+(3*4)			;  4 Console OUTput.
0024   0000             LIST:		.EQU	BIOS+(3*5)			;  5 List OUTput.
0025   0000             PUNCH:		.EQU	BIOS+(3*6)			;  6 Punch OUTput.
0026   0000             READER:		.EQU	BIOS+(3*7)			;  7 Reader input.
0027   0000             HOME:		.EQU	BIOS+(3*8)			;  8 Home disk.
0028   0000             SELDSK:		.EQU	BIOS+(3*9)			;  9 Select disk.
0029   0000             SETTRK:		.EQU	BIOS+(3*10)			; 10 Select track.
0030   0000             SETSEC:		.EQU	BIOS+(3*11)			; 11 Select sector.
0031   0000             SETDMA:		.EQU	BIOS+(3*12)			; 12 Set DMA ADDress.
0032   0000             READ:		.EQU	BIOS+(3*13)			; 13 Read 128 bytes.
0033   0000             WRITE:		.EQU	BIOS+(3*14)			; 14 Write 128 bytes.
0034   0000             LISTST:		.EQU	BIOS+(3*15)			; 15 List status.
0035   0000             SECTRAN:	.EQU	BIOS+(3*16)			; 16 Sector translate.
0036   0000             PRINTSEQ:	.EQU	BIOS+(3*17)			; not a BIOS function
0037   0000             
0038   0000             ;================================================================================================
0039   0000             ; ASCII characters.
0040   0000             ;================================================================================================
0041   0000             NUL			.EQU	00H
0042   0000             SOH			.EQU	01H
0043   0000             STX			.EQU	02H
0044   0000             ETX			.EQU	03H
0045   0000             EOT			.EQU	04H
0046   0000             ENQ			.EQU	05H
0047   0000             QCK			.EQU	06H
0048   0000             BEL			.EQU	07H
0049   0000             BS			.EQU	08H			; ^H
0050   0000             HT			.EQU	09H
0051   0000             LF			.EQU	0AH
0052   0000             VT			.EQU	0BH
0053   0000             FF			.EQU	0CH
0054   0000             CR			.EQU	0DH
0055   0000             SO			.EQU	0EH
0056   0000             SI			.EQU	0FH
0057   0000             DLE			.EQU	10H
0058   0000             DC1			.EQU	11H
0059   0000             DC2			.EQU	12H
0060   0000             DC3			.EQU	13H
0061   0000             DC4			.EQU	14H
0062   0000             NAK			.EQU	15H			; ^U
0063   0000             SYN			.EQU	16H
0064   0000             ETB			.EQU	17H
0065   0000             CAN			.EQU	18H			; ^X
0066   0000             EM			.EQU	19H
0067   0000             SUB			.EQU	1AH
0068   0000             ESC			.EQU	1BH
0069   0000             FS			.EQU	1CH
0070   0000             GS			.EQU	1DH
0071   0000             RS			.EQU	1EH
0072   0000             US			.EQU	1FH
0073   0000             
0074   0000             ;================================================================================================
0075   0000             ; Some constants
0076   0000             ;================================================================================================
0077   0000             MAXLBUF		.EQU	DMA+80
0078   0000             
0079   0000             ;================================================================================================
0080   0100             			.ORG TPA
0081   0100             
0082   0100 21 80 00    			LD	HL,DMA
0083   0103 22 A7 01    			LD	(LBUFPTR),HL
0084   0106 0E 0D       			LD	C,CR
0085   0108 CD 0C E6    			CALL CONOUT
0086   010B 0E 0A       			LD	C,LF
0087   010D CD 0C E6    			CALL CONOUT
0088   0110 0E 7D       			LD	C,'}'
0089   0112 CD 0C E6    			CALL CONOUT
0090   0115 CD 09 E6    WAITCHAR:	CALL CONIN
0091   0118 FE 18       			CP	CAN
0092   011A 28 40       			JR	Z,GOTCAN
0093   011C FE 0D       			CP	CR
0094   011E 28 29       			JR	Z,GOTCR
0095   0120 FE 08       			CP	BS
0096   0122 28 1E       			JR	Z,GOTBS
0097   0124 2A A7 01    			LD	HL,(LBUFPTR)
0098   0127 01 D0 00    			LD	BC,MAXLBUF
0099   012A 37          			SCF
0100   012B 3F          			CCF
0101   012C ED 42       			SBC	HL,BC
0102   012E 28 0E       			JR	Z,LBUFFULL
0103   0130 2A A7 01    			LD	HL,(LBUFPTR)
0104   0133 77          			LD	(HL),A
0105   0134 23          			INC	HL
0106   0135 22 A7 01    			LD	(LBUFPTR),HL
0107   0138 4F          			LD	C,A
0108   0139 CD 0C E6    OUTWAIT:	CALL CONOUT
0109   013C 18 D7       			JR	WAITCHAR
0110   013E 0E 07       LBUFFULL:	LD	C,BEL
0111   0140 18 F7       			JR	OUTWAIT
0112   0142 16 01       GOTBS:		LD	D,1
0113   0144 CD 60 01    AFTGOTBS:	CALL BSPROC
0114   0147 18 CC       			JR	WAITCHAR
0115   0149 2A A7 01    GOTCR:		LD	HL,(LBUFPTR)
0116   014C 3E 00       			LD	A,0
0117   014E 77          			LD	(HL),A
0118   014F 0E 0D       			LD	C,CR
0119   0151 CD 0C E6    			CALL CONOUT
0120   0154 0E 0A       			LD	C,LF
0121   0156 CD 0C E6    			CALL CONOUT
0122   0159 C3 8E 01    			JP	UPPER
0123   015C 16 00       GOTCAN:		LD	D,0
0124   015E 18 E4       			JR	AFTGOTBS
0125   0160             
0126   0160 2A A7 01    BSPROC:		LD	HL,(LBUFPTR)
0127   0163 01 80 00    			LD	BC,DMA
0128   0166 37          			SCF
0129   0167 3F          			CCF
0130   0168 ED 42       			SBC	HL,BC
0131   016A 28 1C       			JR	Z,LBUFEMPTY
0132   016C 2A A7 01    			LD	HL,(LBUFPTR)
0133   016F 2B          			DEC	HL
0134   0170 22 A7 01    			LD	(LBUFPTR),HL
0135   0173 0E 08       			LD	C,BS
0136   0175 CD 0C E6    			CALL CONOUT
0137   0178 0E 20       			LD	C,' '
0138   017A CD 0C E6    			CALL CONOUT
0139   017D 0E 08       			LD	C,BS
0140   017F CD 0C E6    			CALL CONOUT
0141   0182 7A          			LD	A,D
0142   0183 FE 01       			CP	1
0143   0185 C8          			RET	Z
0144   0186 18 D8       			JR	BSPROC
0145   0188 0E 07       LBUFEMPTY:	LD	C,BEL
0146   018A CD 0C E6    			CALL CONOUT
0147   018D C9          			RET
0148   018E             			
0149   018E 21 7F 00    UPPER:		LD	HL,DMA-1
0150   0191 23          NEXT2UP:	INC	HL
0151   0192 7E          			LD	A,(HL)
0152   0193 FE 00       			CP	0
0153   0195 CA 03 E6    			JP	Z,WBOOT
0154   0198 FE 61       			CP	'a'
0155   019A FA 91 01    			JP	M,NEXT2UP
0156   019D FE 7B       			CP	'{'
0157   019F F2 91 01    			JP	P,NEXT2UP
0158   01A2 D6 20       			SUB	20H
0159   01A4 77          			LD	(HL),A
0160   01A5 18 EA       			JR	NEXT2UP
0161   01A7             			
0162   01A7             
0163   01A7             
0164   01A7             ;================================================================================================
0165   01A7 00 00       LBUFPTR		.DW		0
0166   01A9             
0167   01A9             
0168   01A9             			.END
tasm: Number of errors = 0
