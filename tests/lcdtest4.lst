0001   0000             ; Initialize LCD and write something
0002   0000             ; CPU @ 4.0MHz (this is important for the delay routines)
0003   0000             ;
0004   0000             ; RS  = A0 from CPU
0005   0000             ; R/W = A1 from CPU
0006   0000             ; E   = 74LS85 output pin 'A=B'
0007   0000             ;
0008   0000             
0009   0000             IOBYTE		.EQU	3
0010   0000             DT			.EQU	1			; delta t (s)
0011   0000             
0012   0000             LF			.EQU	0AH
0013   0000             FF			.EQU	0CH
0014   0000             CR			.EQU	0DH
0015   0000             DC1			.EQU	11H
0016   0000             DC2			.EQU	12H
0017   0000             
0018   0000             BIOS		.EQU	0E600H
0019   0000             LIST		.EQU	BIOS+15
0020   0000             ;*******************************************************************************
0021   0100             			.ORG	0100h
0022   0100             			
0023   0100 CD 8E 01    			CALL LCDINIT
0024   0103             
0025   0103 CD 99 01    AGAIN:		CALL LCDCLEAR
0026   0106 CD AA 01    			CALL LCDPRINT
0027   0109 5A 38 30 20 			.DB	"Z80 Modular     ",0
0027   010D 4D 6F 64 75 
0027   0111 6C 61 72 20 
0027   0115 20 20 20 20 
0027   0119 00 
0028   011A 06 01       			LD 	B,DT
0029   011C CD 78 01    			CALL DELAYS
0030   011F CD AA 01    			CALL LCDPRINT
0031   0122 0D 0A 43 6F 			.DB	CR,LF,"Computer        ",0
0031   0126 6D 70 75 74 
0031   012A 65 72 20 20 
0031   012E 20 20 20 20 
0031   0132 20 20 00 
0032   0135 06 01       			LD 	B,DT
0033   0137 CD 78 01    			CALL DELAYS
0034   013A CD AA 01    			CALL LCDPRINT
0035   013D 0D 0A 62 79 			.DB	CR,LF,"by Kaltchuk     ",0
0035   0141 20 4B 61 6C 
0035   0145 74 63 68 75 
0035   0149 6B 20 20 20 
0035   014D 20 20 00 
0036   0150 06 01       			LD 	B,DT
0037   0152 CD 78 01    			CALL DELAYS
0038   0155 0E 40       			LD	C,40H
0039   0157 CD 9F 01    			CALL LCDPOS
0040   015A CD AA 01    			CALL LCDPRINT
0041   015D 0D 0A 44 65 			.DB	CR,LF,"December/2020   ",0
0041   0161 63 65 6D 62 
0041   0165 65 72 2F 32 
0041   0169 30 32 30 20 
0041   016D 20 20 00 
0042   0170 06 01       			LD 	B,DT
0043   0172 CD 78 01    			CALL DELAYS
0044   0175 C3 03 01    			JP	AGAIN
0045   0178             
0046   0178             ;================================================================================================
0047   0178             ; Delay X seconds, with X passed on reg B
0048   0178             ;================================================================================================
0049   0178             DELAYS:
0050   0178 C5          			PUSH	BC
0051   0179 E5          			PUSH	HL
0052   017A 21 8F 02    LOOP0:		LD	HL,655		;2.5				\
0053   017D 0E FF       LOOP1:		LD	C,255		;1.75	\			|
0054   017F 0D          LOOP2:		DEC	C			;1		|			|
0055   0180 00          			NOP				;1		| t=6C+0.5	| 
0056   0181 79          			LD	A,C			;1		|			| t=HL(6C+6.5)+1.25
0057   0182 20 FB       			JR	NZ,LOOP2	;3/1.75	/			|
0058   0184 2B          			DEC	HL			;1					| with HL=655 and c=255, t=1.006sec (WOW!!!)
0059   0185 7C          			LD	A,H			;1					|
0060   0186 B5          			OR	L			;1					|
0061   0187 20 F4       			JR	NZ,LOOP1	;3/1.75				/
0062   0189 10 EF       			DJNZ	LOOP0	;3.25/2
0063   018B E1          			POP	HL
0064   018C C1          			POP	BC
0065   018D C9          			RET
0066   018E             
0067   018E             ;================================================================================================
0068   018E             ; Init IOBYTE and LCD card.
0069   018E             ;================================================================================================
0070   018E 3E C0       LCDINIT:	LD	A,0C0H
0071   0190 32 03 00    			LD	(IOBYTE),A
0072   0193 0E 11       			LD	C,DC1
0073   0195 CD 0F E6    			CALL LIST
0074   0198 C9          			RET
0075   0199             
0076   0199             ;================================================================================================
0077   0199             ; Clear LCD and goto line 1, column 1.
0078   0199             ;================================================================================================
0079   0199 0E 0C       LCDCLEAR:	LD	C,FF
0080   019B CD 0F E6    			CALL LIST
0081   019E C9          			RET
0082   019F             
0083   019F             ;================================================================================================
0084   019F             ; Position LCD cursor
0085   019F             ;================================================================================================
0086   019F C5          LCDPOS:		PUSH BC
0087   01A0 0E 12       			LD	C,DC2
0088   01A2 CD 0F E6    			CALL LIST
0089   01A5 C1          			POP	BC
0090   01A6 CD 0F E6    			CALL LIST
0091   01A9 C9          			RET
0092   01AA             
0093   01AA             ;================================================================================================
0094   01AA             ; Send to LCD a sequence of characters ending with zero
0095   01AA             ;================================================================================================
0096   01AA E3          LCDPRINT:	EX 	(SP),HL 		; Push HL and put RET address into HL
0097   01AB F5          			PUSH AF
0098   01AC C5          			PUSH BC
0099   01AD 7E          NEXTCHAR:	LD 	A,(HL)
0100   01AE FE 00       			CP	0
0101   01B0 28 07       			JR	Z,ENDOFPRINT
0102   01B2 4F          			LD	C,A
0103   01B3 CD 0F E6    			CALL LIST
0104   01B6 23          			INC HL
0105   01B7 18 F4       			JR	NEXTCHAR
0106   01B9 23          ENDOFPRINT:	INC HL 			; Get past "null" terminator
0107   01BA C1          			POP BC
0108   01BB F1          			POP AF
0109   01BC E3          			EX 	(SP),HL 		; Push new RET address on stack and restore HL
0110   01BD C9          			RET
0111   01BE             
0112   01BE             
0113   01BE             
0114   01BE             
0115   01BE             
0116   01BE             
0117   01BE             
0118   01BE             			.END
tasm: Number of errors = 0
