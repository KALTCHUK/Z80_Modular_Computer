0001   0000             ;==================================================================================
0002   0000             ; LINER.ASM - TEST FOR CONSOLE MANAGER FOR MONITOR 2.0 - USE WITH VT100 TEMINAL
0003   0000             ; (Should behave like CCP on CP/M)
0004   0000             ;
0005   0000             ; Backspace = delete last character
0006   0000             ;   ^U = ^X = delete all the line
0007   0000             ;
0008   0000             ; After user types <ENTER>, the line is saved in line_buffer and control returns
0009   0000             ; to Monitor program.
0010   0000             ;==================================================================================
0011   0000             TPA			.EQU	0100H		; Transient Programs Area
0012   0000             MONITOR		.EQU	0D000H		; Monitor entry point
0013   0000             BIOS		.EQU	0E600H		; BIOS entry point
0014   0000             DMA			.EQU	0080H		; Buffer user by liner
0015   0000             
0016   0000             ;================================================================================================
0017   0000             ; BIOS functions.
0018   0000             ;================================================================================================
0019   0000             BOOT:		.EQU	BIOS				;  0 Initialize.
0020   0000             WBOOT:		.EQU	BIOS+(3*1)			;  1 Warm boot.
0021   0000             CONST:		.EQU	BIOS+(3*2)			;  2 Console status.
0022   0000             CONIN:		.EQU	BIOS+(3*3)			;  3 Console input.
0023   0000             CONOUT:		.EQU	BIOS+(3*4)			;  4 Console OUTput.
0024   0000             LIST:		.EQU	BIOS+(3*5)			;  5 List OUTput.
0025   0000             PUNCH:		.EQU	BIOS+(3*6)			;  6 Punch OUTput.
0026   0000             READER:		.EQU	BIOS+(3*7)			;  7 Reader input.
0027   0000             HOME:		.EQU	BIOS+(3*8)			;  8 Home disk.
0028   0000             SELDSK:		.EQU	BIOS+(3*9)			;  9 Select disk.
0029   0000             SETTRK:		.EQU	BIOS+(3*10)			; 10 Select track.
0030   0000             SETSEC:		.EQU	BIOS+(3*11)			; 11 Select sector.
0031   0000             SETDMA:		.EQU	BIOS+(3*12)			; 12 Set DMA ADDress.
0032   0000             READ:		.EQU	BIOS+(3*13)			; 13 Read 128 bytes.
0033   0000             WRITE:		.EQU	BIOS+(3*14)			; 14 Write 128 bytes.
0034   0000             LISTST:		.EQU	BIOS+(3*15)			; 15 List status.
0035   0000             SECTRAN:	.EQU	BIOS+(3*16)			; 16 Sector translate.
0036   0000             PRINTSEQ:	.EQU	BIOS+(3*17)			; not a BIOS function
0037   0000             
0038   0000             ;================================================================================================
0039   0000             ; ASCII characters.
0040   0000             ;================================================================================================
0041   0000             NUL			.EQU	00H
0042   0000             SOH			.EQU	01H
0043   0000             STX			.EQU	02H
0044   0000             ETX			.EQU	03H
0045   0000             EOT			.EQU	04H
0046   0000             ENQ			.EQU	05H
0047   0000             QCK			.EQU	06H
0048   0000             BEL			.EQU	07H
0049   0000             BS			.EQU	08H			; ^H
0050   0000             HT			.EQU	09H
0051   0000             LF			.EQU	0AH
0052   0000             VT			.EQU	0BH
0053   0000             FF			.EQU	0CH
0054   0000             CR			.EQU	0DH
0055   0000             SO			.EQU	0EH
0056   0000             SI			.EQU	0FH
0057   0000             DLE			.EQU	10H
0058   0000             DC1			.EQU	11H
0059   0000             DC2			.EQU	12H
0060   0000             DC3			.EQU	13H
0061   0000             DC4			.EQU	14H
0062   0000             NAK			.EQU	15H			; ^U
0063   0000             SYN			.EQU	16H
0064   0000             ETB			.EQU	17H
0065   0000             CAN			.EQU	18H			; ^X
0066   0000             EM			.EQU	19H
0067   0000             SUB			.EQU	1AH
0068   0000             ESC			.EQU	1BH
0069   0000             FS			.EQU	1CH
0070   0000             GS			.EQU	1DH
0071   0000             RS			.EQU	1EH
0072   0000             US			.EQU	1FH
0073   0000             
0074   0000             ;================================================================================================
0075   0000             ; Some constants
0076   0000             ;================================================================================================
0077   0000             MAXLBUFPTR	.EQU	DMA+80
0078   0000             
0079   0000             ;================================================================================================
0080   0100             			.ORG TPA
0081   0100             
0082   0100 21 80 00    			LD	HL,DMA
0083   0103 22 86 01    			LD	(LBUFPTR),HL
0084   0106 36 00       			LD	(HL),0
0085   0108 0E 0D       			LD	C,CR
0086   010A CD 0C E6    			CALL CONOUT
0087   010D 0E 0A       			LD	C,LF
0088   010F CD 0C E6    			CALL CONOUT
0089   0112 0E 7D       			LD	C,'}'
0090   0114 CD 0C E6    			CALL CONOUT
0091   0117 CD 09 E6    WAITCHAR:	CALL CONIN
0092   011A FE 18       			CP	CAN
0093   011C 28 40       			JR	Z,GOTCAN
0094   011E FE 0D       			CP	CR
0095   0120 28 29       			JR	Z,GOTCR
0096   0122 FE 08       			CP	BS
0097   0124 28 1E       			JR	Z,GOTBS
0098   0126 2A 86 01    			LD	HL,(LBUFPTR)
0099   0129 01 D0 00    			LD	BC,MAXLBUFPTR
0100   012C 37          			SCF
0101   012D 3F          			CCF
0102   012E ED 42       			SBC	HL,BC
0103   0130 28 0E       			JR	Z,LBUFFULL
0104   0132 2A 86 01    			LD	HL,(LBUFPTR)
0105   0135 77          			LD	(HL),A
0106   0136 23          			INC	HL
0107   0137 22 86 01    			LD	(LBUFPTR),HL
0108   013A 4F          			LD	C,A
0109   013B CD 0C E6    OUTWAIT:	CALL CONOUT
0110   013E 18 D7       			JR	WAITCHAR
0111   0140 0E 07       LBUFFULL:	LD	C,BEL
0112   0142 18 F7       			JR	OUTWAIT
0113   0144 16 01       GOTBS:		LD	D,1
0114   0146 CD 62 01    AFTGOTBS:	CALL BSPROC
0115   0149 18 CC       			JR	WAITCHAR
0116   014B 2A 86 01    GOTCR:		LD	HL,(LBUFPTR)
0117   014E 3E 00       			LD	A,0
0118   0150 77          			LD	(HL),A
0119   0151 0E 0D       			LD	C,CR
0120   0153 CD 0C E6    			CALL CONOUT
0121   0156 0E 0A       			LD	C,LF
0122   0158 CD 0C E6    			CALL CONOUT
0123   015B C3 03 E6    			JP	WBOOT
0124   015E 16 00       GOTCAN:		LD	D,0
0125   0160 18 E4       			JR	AFTGOTBS
0126   0162 2A 86 01    BSPROC:		LD	HL,(LBUFPTR)
0127   0165 01 80 00    			LD	BC,DMA
0128   0168 37          			SCF
0129   0169 3F          			CCF
0130   016A ED 42       			SBC	HL,BC
0131   016C 28 12       			JR	Z,LBUFEMPTY
0132   016E 2A 86 01    			LD	HL,(LBUFPTR)
0133   0171 2B          			DEC	HL
0134   0172 22 86 01    			LD	(LBUFPTR),HL
0135   0175 0E 08       			LD	C,BS
0136   0177 CD 0C E6    			CALL CONOUT
0137   017A 7A          			LD	A,D
0138   017B FE 01       			CP	1
0139   017D C8          			RET	Z
0140   017E 18 E2       			JR	BSPROC
0141   0180 0E 07       LBUFEMPTY:	LD	C,BEL
0142   0182 CD 0C E6    			CALL CONOUT
0143   0185 C9          			RET
0144   0186             			
0145   0186             
0146   0186             ;================================================================================================
0147   0186 00 00       LBUFPTR		.DW		0
0148   0188             
0149   0188             
0150   0188             			.END
tasm: Number of errors = 0
